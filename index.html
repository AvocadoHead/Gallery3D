<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Floating 3D Gallery</title>
  <link rel="icon" href="data:,"><!-- kill favicon 404 -->

  <style>
    :root {
      --bg-start: #fdfefe;
      --bg-mid: #f6fbff;
      --bg-end: #e7f2ff;
      --panel: rgba(255, 255, 255, 0.78);
      --shadow: rgba(24, 62, 122, 0.18);
      --glow: rgba(96, 165, 250, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at 20% 25%, var(--bg-start), var(--bg-mid) 42%, var(--bg-end));
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #0f1f35;
    }

    #scene {
      position: fixed;
      inset: 0;
    }

    .tile {
      position: relative;
      width: 170px;
      height: 170px;
      border-radius: 22px;
      overflow: hidden;
      box-shadow:
        0 12px 32px var(--shadow),
        0 0 0 1px rgba(255, 255, 255, 0.85),
        0 0 30px var(--glow);
      background: linear-gradient(135deg, #f6f9ff, #e7edff);
      pointer-events: auto;
      transform: scale(0.9);
      opacity: 0;
      filter: saturate(0.9);
      transition:
        transform 0.35s ease,
        opacity 0.5s ease,
        filter 0.35s ease,
        box-shadow 0.35s ease;
    }

    .tile.ready {
      opacity: 1;
      transform: scale(1);
    }

    .tile img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.45s ease, filter 0.4s ease;
      opacity: 0.9;
    }

    .tile:hover {
      transform: scale(1.08);
      filter: saturate(1);
      box-shadow:
        0 16px 44px rgba(27, 73, 140, 0.28),
        0 0 0 1px rgba(255, 255, 255, 0.9),
        0 0 42px rgba(107, 148, 255, 0.45);
    }

    .tile:hover img {
      opacity: 1;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(244, 248, 255, 0.7);
      backdrop-filter: blur(14px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 12;
    }

    .overlay.active { display: flex; }

    .overlay img {
      max-width: min(92vw, 1400px);
      max-height: 88vh;
      border-radius: 24px;
      box-shadow: 0 22px 60px rgba(20, 60, 128, 0.35);
      background: #fff;
      opacity: 0;
      transition: opacity 0.45s ease;
    }

    .overlay img.visible { opacity: 1; }

    .overlay .close {
      position: fixed;
      top: 18px;
      right: 18px;
      width: 44px;
      height: 44px;
      border-radius: 14px;
      border: none;
      background: var(--panel);
      box-shadow: 0 12px 30px rgba(24, 62, 122, 0.25);
      cursor: pointer;
      font-size: 20px;
      color: #0f1f35;
      display: grid;
      place-items: center;
    }

    .launch-ghost {
      position: fixed;
      border-radius: 22px;
      background-size: cover;
      background-position: center;
      box-shadow:
        0 18px 48px rgba(24, 62, 122, 0.28),
        0 0 0 1px rgba(255, 255, 255, 0.7);
      z-index: 20;
      pointer-events: none;
      transform-origin: center;
      transition:
        transform 0.55s cubic-bezier(0.25, 0.8, 0.25, 1),
        opacity 0.45s ease;
      opacity: 0.98;
    }

    .loader {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      z-index: 4;
      pointer-events: none;
      transition: opacity 0.45s ease;
    }

    .loader.hidden { opacity: 0; }

    .loader .dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: linear-gradient(135deg, #7dd3fc, #60a5fa);
      box-shadow: 0 0 0 10px rgba(124, 181, 255, 0.28);
      animation: pulse 1.6s ease-in-out infinite;
    }

    @keyframes pulse {
      0%   { transform: scale(0.9);  opacity: 0.85; }
      50%  { transform: scale(1.15); opacity: 1; }
      100% { transform: scale(0.9);  opacity: 0.85; }
    }

    footer {
      position: fixed;
      bottom: 14px;
      right: 14px;
      z-index: 6;
    }

    footer a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 14px;
      background: var(--panel);
      box-shadow: 0 10px 28px rgba(24, 62, 122, 0.18);
      color: #0f1f35;
      text-decoration: none;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    footer a span {
      font-size: 13px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div id="scene"></div>

  <div class="loader"><div class="dot"></div></div>

  <div class="overlay" id="viewer" aria-hidden="true">
    <button class="close" aria-label="Close">Ã—</button>
    <img alt="Artwork" />
  </div>

  <footer>
    <a href="https://wa.me/97236030603" target="_blank" rel="noreferrer">
      WhatsApp
      <span>+972 3 6030603</span>
    </a>
  </footer>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.165.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.165.0/examples/jsm/controls/OrbitControls.js';
    import { CSS3DRenderer, CSS3DObject } from 'https://unpkg.com/three@0.165.0/examples/jsm/renderers/CSS3DRenderer.js';

    // === 1. YOUR DRIVE LINKS (paste your existing rawLinks array here) ===
    const rawLinks = [
      /* paste all your
         https://drive.google.com/file/d/.../view?usp=drive_link
         urls here, exactly as you have them now */
    ];
    // === end of rawLinks ===

    // Use the URLs directly, no ID magic
    const images = rawLinks
      .map((u) => (u && u.trim()) || '')
      .filter(Boolean)
      .map((url, index) => ({ url, index }));

    const TOTAL = images.length;

    // DOM references
    const sceneEl    = document.getElementById('scene');
    const overlay    = document.getElementById('viewer');
    const overlayImg = overlay.querySelector('img');
    const closeBtn   = overlay.querySelector('.close');
    const loader     = document.querySelector('.loader');

    // THREE setup
    const scene  = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      65,
      window.innerWidth / window.innerHeight,
      0.1,
      5000
    );
    camera.position.set(0, 0, 800);

    const renderer = new CSS3DRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.domElement.style.position = 'fixed';
    renderer.domElement.style.inset = '0';
    sceneEl.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping   = true;
    controls.dampingFactor   = 0.08;
    controls.enableZoom      = true;
    controls.autoRotate      = true;
    controls.autoRotateSpeed = 0.35;
    controls.minDistance     = 600;
    controls.maxDistance     = 2000;
    controls.target.set(0, 0, 0);
    controls.update();

    const radius = 1200;
    const jitter = 200;

    let firstReady = false;
    let ghost;

    function addTile(i) {
      const { url } = images[i];

      const element = document.createElement('div');
      element.className = 'tile';

      const img = document.createElement('img');
      img.alt = `Artwork ${i + 1}`;
      img.loading = 'lazy';
      img.decoding = 'async';
      img.src = url;              // <-- direct Drive URL, as before

      img.addEventListener('load', () => {
        element.classList.add('ready');
        if (!firstReady) {
          firstReady = true;
          loader.classList.add('hidden');
          setTimeout(() => loader.remove(), 600);
        }
      });

      img.addEventListener('error', () => {
        // If Drive blocks something or a link is bad, still show a tile
        element.classList.add('ready');
      });

      element.appendChild(img);

      element.addEventListener('click', () => {
        launchViewer(i, element);
      });

      const object = new CSS3DObject(element);

      // Fibonacci sphere layout
      const phi   = Math.acos(1 - 2 * (i + 0.5) / TOTAL);
      const theta = Math.PI * (1 + Math.sqrt(5)) * (i + 0.5);
      const r     = radius + (Math.random() - 0.5) * jitter;

      object.position.setFromSphericalCoords(r, phi, theta);
      object.lookAt(new THREE.Vector3(0, 0, 0));
      scene.add(object);
    }

    for (let i = 0; i < TOTAL; i++) {
      addTile(i);
    }

    function launchViewer(i, element) {
      const { url } = images[i];
      const rect = element.getBoundingClientRect();

      if (ghost) ghost.remove();
      ghost = document.createElement('div');
      ghost.className = 'launch-ghost';
      ghost.style.width  = `${rect.width}px`;
      ghost.style.height = `${rect.height}px`;
      ghost.style.left   = `${rect.left}px`;
      ghost.style.top    = `${rect.top}px`;
      const img = element.querySelector('img');
      if (img && img.src) {
        ghost.style.backgroundImage = `url(${img.src})`;
      }
      document.body.appendChild(ghost);

      const centerX = window.innerWidth / 2 - rect.left - rect.width / 2;
      const centerY = window.innerHeight / 2 - rect.top - rect.height / 2;

      requestAnimationFrame(() => {
        ghost.style.transform = `translate(${centerX}px, ${centerY}px) scale(6)`;
        ghost.style.opacity = '0';
      });

      setTimeout(() => {
        if (ghost) ghost.remove();
      }, 650);

      overlay.classList.add('active');
      overlay.setAttribute('aria-hidden', 'false');
      overlayImg.classList.remove('visible');
      overlayImg.src = url;   // fullscreen uses the same Drive URL
      overlayImg.onload = () => overlayImg.classList.add('visible');
    }

    function closeViewer() {
      overlay.classList.remove('active');
      overlay.setAttribute('aria-hidden', 'true');
      overlayImg.classList.remove('visible');
      overlayImg.src = '';
    }

    closeBtn.addEventListener('click', closeViewer);
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) closeViewer();
    });
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeViewer();
    });

    function onResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    window.addEventListener('resize', onResize);

    const driftTarget = new THREE.Vector3();

    function animate() {
      controls.update();

      const t = Date.now() * 0.00007;
      driftTarget.set(Math.sin(t) * 40, Math.cos(t * 1.2) * 40, 0);
      scene.position.lerp(driftTarget, 0.005);

      scene.children.forEach((child) => {
        if (child instanceof CSS3DObject) {
          child.lookAt(camera.position);
        }
      });

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    animate();
  </script>
</body>
</html>
